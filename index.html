<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Device Tracker â€” RGIT Versova Demo</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{--bg:#f7f8fb;--card:#ffffff;--muted:#6b7280;--accent:#2563eb;--glass:rgba(255,255,255,0.6)}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:#0f1724}
    .wrap{max-width:1100px;margin:32px auto;padding:18px}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .layout{display:grid;grid-template-columns:280px 1fr;gap:16px}
    .panel{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 20px rgba(15,23,42,0.06)}

    #map{height:520px;border-radius:12px}
    .btn{border-radius:8px}

    /* Circuit and code sections */
    #circuitWrap{margin-top:18px}
    .circuit-panel{padding:18px;border-radius:12px;background:linear-gradient(180deg,#fff,#fbfdff);box-shadow:0 8px 28px rgba(15,23,42,0.05)}
    .svg-wrap{width:100%;height:320px;margin-top:12px}
    svg{width:100%;height:100%}
    .wire{stroke:#9aa6b2;stroke-width:3;fill:none}
    .wire.current{stroke:#2563eb;stroke-width:4;stroke-linecap:round;stroke-dasharray:12 8;animation:flow 1.8s linear infinite}
    .comp{fill:#f1f5f9;stroke:#dbe7fb;stroke-width:1.5;rx:8}
    .chip{fill:#eef2ff;stroke:#cfe1ff}
    .label{font-size:12px;fill:#334155;font-weight:600}
    .led{fill:#ff4d4f;stroke:#fff;stroke-width:1}
    .led.off{fill:#f3a3a3}
    .led.blink{animation:blink 1s infinite}
    @keyframes flow{to{stroke-dashoffset:-20}}
    @keyframes blink{50%{opacity:0.18}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Device Tracker â€” RGIT Versova Demo</h1>
        <p class="lead">Click a device to start its simulated movement around MCT RGIT (Versova).</p>
      </div>
    </header>

    <div class="layout mb-4">
      <aside class="panel">
        <div>
          <div class="small text-muted">Devices</div>
          <p class="status">Tap a device to simulate continuous movement</p>
        </div>
        <div class="devices" id="devicesList" style="margin-top:12px"></div>
        <div class="mt-3">
          <div class="small">Selected Device</div>
          <div id="selectedName" class="fw-bold">â€”</div>
          <div class="small">Latitude</div>
          <div id="latVal" class="fw-bold">â€”</div>
          <div class="small">Longitude</div>
          <div id="lngVal" class="fw-bold">â€”</div>
          <div class="d-flex gap-2 mt-2">
            <button id="btnStop" class="btn btn-outline-secondary btn-sm">Stop</button>
            <button id="btnCenter" class="btn btn-primary btn-sm">Center Map</button>
          </div>
        </div>
      </aside>

      <main>
        <div class="panel p-2">
          <div id="map"></div>
        </div>
      </main>
    </div>

    <!-- Circuit Simulation Section -->
    <div id="circuitWrap">
      <div class="circuit-panel panel mb-4">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <div>
            <h5 class="fw-bold mb-1">Circuit Simulation</h5>
            <p class="text-muted small mb-0">SVG + CSS: battery â†’ STM32 (blue pill) â†’ GPS â†’ LCD. Use Start to animate flow.</p>
          </div>
          <div class="d-flex gap-2">
            <button id="cStart" class="btn btn-primary btn-sm">Start</button>
            <button id="cStop" class="btn btn-outline-secondary btn-sm">Stop</button>
          </div>
        </div>
        <div class="svg-wrap">
          <svg viewBox="0 0 1000 360" xmlns="http://www.w3.org/2000/svg">
            <rect x="30" y="120" width="120" height="100" class="comp" rx="8"/>
            <text x="90" y="155" text-anchor="middle" class="label">Battery</text>
            <rect x="220" y="90" width="180" height="140" class="chip" rx="10"/>
            <text x="310" y="130" text-anchor="middle" class="label">STM32</text>
            <rect x="470" y="120" width="140" height="80" class="comp" rx="8"/>
            <text x="540" y="155" text-anchor="middle" class="label">GPS</text>
            <rect x="700" y="100" width="200" height="120" class="comp" rx="10"/>
            <text x="800" y="140" text-anchor="middle" class="label">LCD</text>
            <path d="M150 170 L220 170" class="wire" id="w1"/>
            <path d="M400 170 L470 170" class="wire" id="w2"/>
            <path d="M610 160 L700 160" class="wire" id="w3"/>
            <path d="M150 190 L220 190" class="wire"/>
            <path d="M400 190 L470 190" class="wire"/>
            <path d="M610 180 L700 180" class="wire"/>
            <path d="M150 170 L220 170" class="wire current" id="f1" style="visibility:hidden"/>
            <path d="M400 170 L470 170" class="wire current" id="f2" style="visibility:hidden"/>
            <path d="M610 160 L700 160" class="wire current" id="f3" style="visibility:hidden"/>
            <circle cx="420" cy="105" r="8" class="led" id="led1"/>
            <circle r="6" fill="#2563eb" id="dot" style="visibility:hidden">
              <animateMotion id="motion" dur="4s" repeatCount="indefinite" path="M150 170 L220 170 L310 170 L400 170 L470 170 L540 170 L610 160 L700 160" />
            </circle>
          </svg>
        </div>
      </div>
    </div>

    <!-- Code Section -->
    <div class="accordion" id="codeAccordion">
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingOne">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCode" aria-expanded="false" aria-controls="collapseCode">
            ðŸ’» Project Source Code
          </button>
        </h2>
        <div id="collapseCode" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#codeAccordion">
          <div class="accordion-body">
            <pre><code id="projectCode" style="white-space:pre-wrap;font-family:monospace;font-size:13px;color:#111;background:#f9fafb;padding:10px;border-radius:8px;display:block;">// Paste your complete STM32 GPS Tracker project code here...</code></pre>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Leaflet tracking (same logic)
    const devices = [
      {id: 'hrudyan', name: 'Hrudyan', color:'#2563eb'},
      {id: 'nitish', name: 'Nitish V', color:'#f97316'}
    ];
    const mapCenter = [19.1260, 72.8360];
    const map = L.map('map', {center: mapCenter, zoom:16});
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
    const state = {};
    devices.forEach((d,i)=>{
      const lat = 19.1260 + (Math.random()-0.5)*0.0015;
      const lng = 72.8360 + (Math.random()-0.5)*0.0015;
      const marker = L.circleMarker([lat,lng],{radius:8,fillColor:d.color,color:'#fff',weight:2,fillOpacity:1}).addTo(map);
      marker.bindTooltip(d.name,{permanent:true,direction:'right'}).openTooltip();
      state[d.id] = {info:d,pos:[lat,lng],marker,interval:null,animating:false};
    });

    const devicesList=document.getElementById('devicesList');
    devices.forEach(d=>{
      const el=document.createElement('button');
      el.className='btn btn-light w-100 text-start mb-2';
      el.textContent=d.name;
      el.addEventListener('click',()=>selectDevice(d.id));
      devicesList.appendChild(el);
    });

    let currentId=null;
    const selectedName=document.getElementById('selectedName');
    const latVal=document.getElementById('latVal');
    const lngVal=document.getElementById('lngVal');
    const btnStop=document.getElementById('btnStop');
    const btnCenter=document.getElementById('btnCenter');

    btnStop.addEventListener('click',()=>{if(currentId)stopSimulation(currentId)});
    btnCenter.addEventListener('click',()=>{if(currentId){map.setView(state[currentId].pos,17)}});

    function selectDevice(id){
      currentId=id;
      selectedName.textContent=state[id].info.name;
      updateCoordsDisplay(state[id].pos[0],state[id].pos[1]);
      if(!state[id].interval)startSimulation(id);
      map.setView(state[id].pos,17);
    }
    function updateCoordsDisplay(lat,lng){latVal.textContent=lat.toFixed(6);lngVal.textContent=lng.toFixed(6);}
    function startSimulation(id){const i=state[id];if(i.interval)return;scheduleMove(id);i.interval=setInterval(()=>scheduleMove(id),6000)}
    function stopSimulation(id){const i=state[id];if(i.interval){clearInterval(i.interval);i.interval=null;}i.animating=false;}
    function scheduleMove(id){const i=state[id];const[lat,lng]=i.pos;const dLat=(Math.random()-0.5)*0.002;const dLng=(Math.random()-0.5)*0.002;const newLat=Math.min(Math.max(lat+dLat,19.1235),19.1285);const newLng=Math.min(Math.max(lng+dLng,72.8335),72.8385);animateMarker(id,[lat,lng],[newLat,newLng],3500);i.pos=[newLat,newLng];if(currentId===id)updateCoordsDisplay(newLat,newLng);}
    function animateMarker(id,from,to,duration){const i=state[id];const m=i.marker;if(i.animating)return;i.animating=true;const s=performance.now();function step(n){const t=Math.min(1,(n-s)/duration);const e=t<0.5?2*t*t:-1+(4-2*t)*t;const lat=from[0]+(to[0]-from[0])*e;const lng=from[1]+(to[1]-from[1])*e;m.setLatLng([lat,lng]);if(t<1)requestAnimationFrame(step);else i.animating=false;}requestAnimationFrame(step);}

    // Circuit
    const cStart=document.getElementById('cStart');const cStop=document.getElementById('cStop');const flows=[document.getElementById('f1'),document.getElementById('f2'),document.getElementById('f3')];const dot=document.getElementById('dot');const led1=document.getElementById('led1');
    cStart.addEventListener('click',()=>{flows.forEach(f=>f.style.visibility='visible');dot.style.visibility='visible';led1.classList.add('blink');});
    cStop.addEventListener('click',()=>{flows.forEach(f=>f.style.visibility='hidden');dot.style.visibility='hidden';led1.classList.remove('blink');});
  </script>
</body>
</html>
